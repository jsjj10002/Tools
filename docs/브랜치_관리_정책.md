# 브랜치 관리 정책

이 문서는 프로젝트의 Git 브랜치 전략과 관리 규칙을 정의합니다.

## 브랜치 구조

### 주요 브랜치 (Main Branches)

#### `main` 브랜치
- **목적**: 프로덕션 배포용 안정 브랜치
- **보호 규칙**: 
  - 직접 푸시 금지
  - PR을 통해서만 머지 가능
  - 코드 리뷰 필수
  - CI/CD 테스트 통과 필수
- **머지 조건**:
  - `develop` 브랜치에서만 머지 가능
  - 모든 테스트 통과
  - 최소 1명 이상의 코드 리뷰 승인
- **배포**: `main` 브랜치에 머지되면 자동으로 프로덕션 배포

#### `develop` 브랜치
- **목적**: 개발 통합 브랜치 (다음 릴리즈를 위한 통합 브랜치)
- **보호 규칙**: 
  - 직접 푸시 허용 (개발자 권한)
  - PR을 통한 머지 권장
- **머지 조건**:
  - `feature/*` 브랜치에서만 머지 가능
  - 최소한의 테스트 통과 권장
- **사용**: 모든 기능 개발은 `develop` 브랜치를 기반으로 생성

### 보조 브랜치 (Supporting Branches)

#### `feature/*` 브랜치
- **목적**: 새로운 기능 개발
- **네이밍 규칙**: `feature/기능명-간단설명` (소문자, 하이픈 구분)
- **생성 기준**: `develop` 브랜치에서 생성
- **생명주기**:
  - 기능 개발 완료 후 `develop` 브랜치로 PR 생성
  - 머지 후 해당 브랜치 삭제
- **예시**:
  - `feature/image-resize`
  - `feature/pdf-merge`
  - `feature/video-compress`

#### `bugfix/*` 브랜치
- **목적**: 버그 수정 (프로덕션 또는 develop 브랜치의 버그)
- **네이밍 규칙**: `bugfix/버그명-간단설명` (소문자, 하이픈 구분)
- **생성 기준**: 
  - 프로덕션 버그: `main` 브랜치에서 생성
  - 개발 중 버그: `develop` 브랜치에서 생성
- **생명주기**:
  - 버그 수정 완료 후 원본 브랜치로 PR 생성
  - 머지 후 해당 브랜치 삭제
- **예시**:
  - `bugfix/memory-leak-pdf-processing`
  - `bugfix/ui-mobile-responsive`

#### `hotfix/*` 브랜치
- **목적**: 프로덕션 긴급 수정
- **네이밍 규칙**: `hotfix/이슈명-간단설명` (소문자, 하이픈 구분)
- **생성 기준**: `main` 브랜치에서 생성
- **생명주기**:
  - 긴급 수정 완료 후 `main`과 `develop` 브랜치 모두에 머지
  - 머지 후 해당 브랜치 삭제
- **예시**:
  - `hotfix/security-patch`
  - `hotfix/critical-bug`

#### `refactor/*` 브랜치
- **목적**: 코드 리팩토링 (기능 변경 없이 코드 개선)
- **네이밍 규칙**: `refactor/영역명-간단설명` (소문자, 하이픈 구분)
- **생성 기준**: `develop` 브랜치에서 생성
- **생명주기**: 
  - 리팩토링 완료 후 `develop` 브랜치로 PR 생성
  - 머지 후 해당 브랜치 삭제
- **예시**:
  - `refactor/component-structure`
  - `refactor/state-management`

## 브랜치 네이밍 규칙

### 기본 규칙
- 소문자 사용
- 하이픈(`-`)으로 단어 구분
- 명확하고 간결한 이름 사용
- 이슈 번호가 있으면 포함: `feature/123-image-resize`

### 금지 사항
- ❌ `cursor/` 접두사 사용 금지 (자동 생성 브랜치 제외)
- ❌ 대문자 사용 금지
- ❌ 언더스코어(`_`) 사용 금지 (하이픈 사용)
- ❌ 특수문자 사용 금지
- ❌ 한글 사용 금지 (영문만 사용)
- ❌ 의미 없는 이름 금지 (예: `test`, `fix`, `update`)

### 좋은 예시
- ✅ `feature/image-resize-tool`
- ✅ `bugfix/pdf-loading-error`
- ✅ `hotfix/security-vulnerability`
- ✅ `refactor/component-hooks`

### 나쁜 예시
- ❌ `cursor/review-pr-fix-errors-and-merge-e62c` (자동 생성 브랜치)
- ❌ `Feature/ImageResize` (대문자)
- ❌ `feature_image_resize` (언더스코어)
- ❌ `fix` (너무 모호함)
- ❌ `update` (명확하지 않음)

## 브랜치 생성 및 관리 워크플로우

### 1. 기능 개발 시작

```bash
# develop 브랜치로 전환
git checkout develop

# 최신 상태로 업데이트
git pull origin develop

# feature 브랜치 생성
git checkout -b feature/image-resize-tool

# 작업 수행...

# 커밋
git add .
git commit -m "feat: Add image resize tool"
```

### 2. 기능 개발 완료 후 PR 생성

```bash
# develop 브랜치 최신 상태로 업데이트
git checkout develop
git pull origin develop

# feature 브랜치로 돌아가서 rebase
git checkout feature/image-resize-tool
git rebase develop

# 충돌 해결 후 푸시
git push origin feature/image-resize-tool

# GitHub에서 PR 생성
# base: develop, compare: feature/image-resize-tool
```

### 3. PR 머지 후 브랜치 정리

```bash
# 로컬 브랜치 삭제
git checkout develop
git pull origin develop
git branch -d feature/image-resize-tool

# 원격 브랜치 삭제 (GitHub에서 자동 삭제되거나 수동 삭제)
git push origin --delete feature/image-resize-tool
```

### 4. 프로덕션 배포 (Release)

```bash
# develop 브랜치에서 main으로 PR 생성
# base: main, compare: develop

# 머지 후 main 브랜치 업데이트
git checkout main
git pull origin main

# develop 브랜치도 업데이트 (main의 변경사항 반영)
git checkout develop
git merge main
git push origin develop
```

## 브랜치 정리 규칙

### 정기 정리 (매주)
- 머지 완료된 `feature/*`, `bugfix/*`, `hotfix/*`, `refactor/*` 브랜치 삭제
- 오래된 자동 생성 브랜치 (`cursor/*`) 정리

### 정리 명령어

```bash
# 로컬 브랜치 정리
git branch --merged develop | grep -v "develop\|main" | xargs git branch -d

# 원격 브랜치 확인
git fetch --prune
git branch -r

# 원격 브랜치 �리 (주의: 머지 완료된 브랜치만)
git push origin --delete 브랜치명
```

## 커밋 메시지 규칙

### 기본 형식
```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type 종류
- `feat`: 새로운 기능 추가
- `fix`: 버그 수정
- `docs`: 문서 수정
- `style`: 코드 포맷팅, 세미콜론 누락 등 (기능 변경 없음)
- `refactor`: 코드 리팩토링
- `test`: 테스트 코드 추가/수정
- `chore`: 빌드 업무 수정, 패키지 매니저 설정 등

### 예시
```
feat(image-tools): Add image resize functionality

- Implement resize with aspect ratio preservation
- Add quality settings (low, medium, high)
- Update UI with resize preview

Closes #123
```

## PR 템플릿

### 기능 개발 PR
```markdown
## 변경 사항
- [ ] 새로운 기능 추가
- [ ] 관련 문서 업데이트
- [ ] 테스트 코드 추가

## 관련 이슈
Closes #이슈번호

## 체크리스트
- [ ] 코드 리뷰 완료
- [ ] 테스트 통과
- [ ] 문서 업데이트
- [ ] 빌드 성공
```

### 버그 수정 PR
```markdown
## 버그 설명
- 버그 내용 상세 설명

## 수정 내용
- 수정 방법 설명

## 테스트
- 테스트 방법 및 결과

## 관련 이슈
Fixes #이슈번호
```

## 예외 상황 처리

### 긴급 프로덕션 수정
1. `main` 브랜치에서 `hotfix/*` 브랜치 생성
2. 수정 완료 후 `main`과 `develop` 모두에 머지
3. 즉시 배포

### 충돌 해결
1. `develop` 브랜치를 최신 상태로 유지
2. 작업 전 `git pull origin develop` 실행
3. 충돌 발생 시 명확한 해결 후 커밋

## 자동 생성 브랜치 정리

`cursor/` 접두사를 가진 브랜치는 Cursor AI가 자동 생성한 브랜치입니다.
이러한 브랜치들은 다음 규칙을 따릅니다:

- 머지 완료 후 즉시 삭제 권장
- 작업 중인 브랜치는 유지 가능
- 1주일 이상 미사용 브랜치는 정리

## 브랜치 보호 규칙

### GitHub 브랜치 보호 설정
- `main` 브랜치: 필수 보호 설정
  - Require pull request reviews
  - Require status checks to pass
  - Require branches to be up to date before merging
  - Do not allow bypassing the above settings

- `develop` 브랜치: 선택적 보호 설정
  - Require pull request reviews (권장)
  - Allow force pushes (개발자 권한)

## 참고 자료

- [Git Flow](https://nvie.com/posts/a-successful-git-branching-model/)
- [Conventional Commits](https://www.conventionalcommits.org/)
- [GitHub Branch Protection](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches)
